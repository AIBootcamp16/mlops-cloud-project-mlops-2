# ============================================================
# ğŸ¨ Streamlit UI Dockerfile (ìµœì í™” ë²„ì „)
# ------------------------------------------------------------
# Base: Python 3.10 slim
# ëª©ì : ë¹ ë¥´ê³  ê°€ë²¼ìš´ UI ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ë¹Œë“œ
# ============================================================

FROM python:3.10-slim AS runtime
WORKDIR /app

# ------------------------------------------------------------
# 1. í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜ (ê¸°ë³¸ ì‹œìŠ¤í…œ ì˜ì¡´ì„±)
# ------------------------------------------------------------
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential libssl-dev libffi-dev curl \
    && rm -rf /var/lib/apt/lists/*

# ------------------------------------------------------------
# 2. Python íŒ¨í‚¤ì§€ ì˜ì¡´ì„± ì„¤ì¹˜
# ------------------------------------------------------------
COPY requirements_ui.txt ./requirements_ui.txt
RUN pip install --no-cache-dir -r requirements_ui.txt

# ------------------------------------------------------------
# 3. ì†ŒìŠ¤ì½”ë“œ ë³µì‚¬
# ------------------------------------------------------------
COPY ./src ./src
COPY ./dataset ./dataset
COPY ./static ./static

# ------------------------------------------------------------
# 4. í™˜ê²½ ì„¤ì • íŒŒì¼ ë³µì‚¬ (.env.safe â†’ .env)
# ------------------------------------------------------------
COPY .env.safe ./.env

# ------------------------------------------------------------
# 5. Streamlit í¬íŠ¸ ì„¤ì • ë° ìºì‹œ ë¹„í™œì„±í™”
# ------------------------------------------------------------
EXPOSE 8501
ENV STREAMLIT_SERVER_PORT=8501
ENV STREAMLIT_SERVER_HEADLESS=true
ENV STREAMLIT_BROWSER_GATHER_USAGE_STATS=false

# ------------------------------------------------------------
# 6. ì‹¤í–‰ ëª…ë ¹
# ------------------------------------------------------------
CMD ["streamlit", "run", "src/ui/app.py", "--server.port=8501", "--server.address=0.0.0.0"]
