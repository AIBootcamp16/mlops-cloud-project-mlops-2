# ============================================================
# 🎨 Streamlit UI Dockerfile (for /web/streamlit_app.py)
# ------------------------------------------------------------
# Base: Python 3.10-slim
# 목적: 빠르고 가벼운 Streamlit UI 컨테이너 이미지 빌드
# ============================================================

FROM python:3.10-slim AS runtime

# ------------------------------------------------------------
# 1. 필수 패키지 설치
# ------------------------------------------------------------
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential libssl-dev libffi-dev curl \
    && rm -rf /var/lib/apt/lists/*

# ------------------------------------------------------------
# 2. 작업 디렉토리 설정
# ------------------------------------------------------------
WORKDIR /app

# ------------------------------------------------------------
# 3. Python 패키지 의존성 설치
# ------------------------------------------------------------
COPY requirements_ui.txt ./requirements_ui.txt
RUN pip install --no-cache-dir -r requirements_ui.txt

# ------------------------------------------------------------
# 4. 소스코드 복사
# ------------------------------------------------------------
COPY ./web ./web           # ✅ Streamlit 앱 폴더
COPY ./dataset ./dataset   # (선택적, 필요 시)
# static 없음

# ------------------------------------------------------------
# 5. 환경 설정 파일 복사 (.env.safe → .env)
# ------------------------------------------------------------
COPY .env.safe ./.env

# ------------------------------------------------------------
# 6. Streamlit 환경 변수
# ------------------------------------------------------------
EXPOSE 8501
ENV STREAMLIT_SERVER_PORT=8501
ENV STREAMLIT_SERVER_HEADLESS=true
ENV STREAMLIT_BROWSER_GATHER_USAGE_STATS=false

# ------------------------------------------------------------
# 7. 실행 명령
# ------------------------------------------------------------
CMD ["streamlit", "run", "web/streamlit_app.py", "--server.port=8501", "--server.address=0.0.0.0"]
