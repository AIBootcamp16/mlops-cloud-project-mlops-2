# ============================================================
# ğŸ¨ Streamlit UI Dockerfile (for /web/streamlit_app.py)
# ------------------------------------------------------------
# Base: Python 3.10-slim
# ëª©ì : ë¹ ë¥´ê³  ê°€ë²¼ìš´ Streamlit UI ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ë¹Œë“œ
# ============================================================

FROM python:3.10-slim AS runtime

# ------------------------------------------------------------
# 1. í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
# ------------------------------------------------------------
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential libssl-dev libffi-dev curl \
    && rm -rf /var/lib/apt/lists/*

# ------------------------------------------------------------
# 2. ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
# ------------------------------------------------------------
WORKDIR /app

# ------------------------------------------------------------
# 3. Python íŒ¨í‚¤ì§€ ì˜ì¡´ì„± ì„¤ì¹˜
# ------------------------------------------------------------
COPY requirements_ui.txt ./requirements_ui.txt
RUN pip install --no-cache-dir -r requirements_ui.txt

# ------------------------------------------------------------
# 4. ì†ŒìŠ¤ì½”ë“œ ë³µì‚¬
# ------------------------------------------------------------
COPY ./web ./web           # âœ… Streamlit ì•± í´ë”
COPY ./dataset ./dataset   # (ì„ íƒì , í•„ìš” ì‹œ)
# static ì—†ìŒ

# ------------------------------------------------------------
# 5. í™˜ê²½ ì„¤ì • íŒŒì¼ ë³µì‚¬ (.env.safe â†’ .env)
# ------------------------------------------------------------
COPY .env.safe ./.env

# ------------------------------------------------------------
# 6. Streamlit í™˜ê²½ ë³€ìˆ˜
# ------------------------------------------------------------
EXPOSE 8501
ENV STREAMLIT_SERVER_PORT=8501
ENV STREAMLIT_SERVER_HEADLESS=true
ENV STREAMLIT_BROWSER_GATHER_USAGE_STATS=false

# ------------------------------------------------------------
# 7. ì‹¤í–‰ ëª…ë ¹
# ------------------------------------------------------------
CMD ["streamlit", "run", "web/streamlit_app.py", "--server.port=8501", "--server.address=0.0.0.0"]
