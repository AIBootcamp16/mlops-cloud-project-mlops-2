# ============================================================
# ğŸš€ Dockerfile.api â€” FastAPI Backend for gogoAiHunters Project
# ------------------------------------------------------------
# íŠ¹ì§•:
#   - python:3.11-slim ê¸°ë°˜
#   - requirements_api.txt ì‚¬ìš©
#   - models / dataset ë””ë ‰í† ë¦¬ ì—†ì„ ê²½ìš° ìë™ ë¬´ì‹œ
# ============================================================

FROM python:3.11-slim AS base

# í™˜ê²½ë³€ìˆ˜ ì„¤ì •
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PIP_NO_CACHE_DIR=off \
    PIP_DISABLE_PIP_VERSION_CHECK=on \
    PATH="/root/.local/bin:$PATH"

WORKDIR /app

# 2ï¸âƒ£ Install dependencies
COPY requirements_api.txt .
RUN pip install --no-cache-dir -r requirements_api.txt

# 3ï¸âƒ£ Copy project files
COPY . .

# 4ï¸âƒ£ Ensure optional folders exist
RUN mkdir -p /app/models /app/dataset \
 && (test -d "./models" && echo "âœ… models found" || echo "âš ï¸ no models, skipping") \
 && (test -d "./dataset" && echo "âœ… dataset found" || echo "âš ï¸ no dataset, skipping")

# 5ï¸âƒ£ Healthcheck
HEALTHCHECK --interval=30s --timeout=5s --start-period=10s --retries=3 \
 CMD curl -f http://localhost:8000/health || exit 1

# 6ï¸âƒ£ Expose & Run
EXPOSE 8000
CMD ["sh", "-c", "uvicorn src.api.api:app --host 0.0.0.0 --port 8000"]
