# íŒŒì´ì¬ 3.10 ë²„ì „ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
FROM python:3.10-slim

# â— LightGBMì— í•„ìš”í•œ ì‹œìŠ¤í…œ ì¢…ì†ì„± ì„¤ì¹˜ â—
RUN apt-get update && apt-get install -y --no-install-recommends \
    libgomp1 \
    && rm -rf /var/lib/apt/lists/*
    
# ì‘ì—… ë””ë ‰í† ë¦¬ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
WORKDIR /app

# ì‹œìŠ¤í…œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ (ì˜ˆ: MySQL í´ë¼ì´ì–¸íŠ¸, í•„ìš”ì‹œ)
# RUN apt-get update && apt-get install -y --no-install-recommends \
#     default-libmysqlclient-dev gcc \
#     && rm -rf /var/lib/apt/lists/*

# ìš”êµ¬ì‚¬í•­ íŒŒì¼ ë³µì‚¬ ë° ì„¤ì¹˜ (ë°±ì—”ë“œì— í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª©ë¡)
# FastAPI, Uvicorn, pandas, joblib, spotipy, pymysql ë“±ì´ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
COPY requirements_api.txt .
RUN pip install --no-cache-dir -r requirements_api.txt

# í”„ë¡œì íŠ¸ ì½”ë“œ ë³µì‚¬
# .env íŒŒì¼ ë“± ë¯¼ê° ì •ë³´ëŠ” docker-composeë¡œ ì „ë‹¬í•´ì•¼ í•©ë‹ˆë‹¤.
COPY . /app

# FastAPI ì„œë²„ í¬íŠ¸ ë…¸ì¶œ
EXPOSE 8000

# ì„œë²„ ì‹¤í–‰ ëª…ë ¹ì–´ (api.py íŒŒì¼ê³¼ uvicorn ì‚¬ìš©)
# --host 0.0.0.0 ì€ ì»¨í…Œì´ë„ˆ ì™¸ë¶€ ì ‘ê·¼ì„ ìœ„í•´ í•„ìˆ˜
# CMD ["uvicorn", "src.api:app", "--host", "0.0.0.0", "--port", "8000"]
CMD ["uvicorn", "src.api.api:app", "--host", "0.0.0.0", "--port", "8000"]

#ğŸ’¡ ì™œ src.api.api:appì¸ê°€ìš”?
# src: í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ src íŒ¨í‚¤ì§€
# .api: src íŒ¨í‚¤ì§€ ë‚´ë¶€ì˜ api í´ë”
# .api: api í´ë” ë‚´ë¶€ì˜ api.py íŒŒì¼ (ëª¨ë“ˆ ì´ë¦„)
# :app: api.py íŒŒì¼ ë‚´ë¶€ì— ì •ì˜ëœ app = FastAPI() ê°ì²´