# ============================================================
# üê≥ FastAPI Backend Dockerfile (for GHCR)
# ============================================================

FROM python:3.11-slim AS base

WORKDIR /app/mlops

# ÌïÑÏàò Ìå®ÌÇ§ÏßÄ ÏÑ§Ïπò
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential curl && rm -rf /var/lib/apt/lists/*

# Python ÏùòÏ°¥ÏÑ± Î≥µÏÇ¨ Î∞è ÏÑ§Ïπò
COPY requirements_api.txt .
RUN pip install --no-cache-dir -r requirements_api.txt

# ÌîÑÎ°úÏ†ùÌä∏ ÏΩîÎìú Î≥µÏÇ¨
COPY ./src ./src

# Î™®Îç∏ Î∞è Îç∞Ïù¥ÌÑ∞ ÎîîÎ†âÌÜ†Î¶¨ ÏÉùÏÑ± (ÏóÜÏùÑ Í≤ΩÏö∞ ÎåÄÎπÑ)
RUN mkdir -p ./models ./dataset/processed

# ÏÑ†ÌÉùÏ†Å ÌååÏùº Î≥µÏÇ¨ (ÏóÜÏñ¥ÎèÑ ÌÜµÍ≥º)
COPY ./models ./models 2>/dev/null || true
COPY ./dataset ./dataset 2>/dev/null || true
COPY .env ./ 2>/dev/null || true

# FastAPI Ìè¨Ìä∏
EXPOSE 8000

CMD ["uvicorn", "src.api.api:app", "--host", "0.0.0.0", "--port", "8000"]
